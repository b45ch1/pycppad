<html><head>
<title>An Error Controller for ODE Solvers</title>
<meta name="description" id="description" content="An Error Controller for ODE Solvers">
<meta name="keywords" id="keywords" content=" Odeerrcontrol Ode control error differential equation ">
<style type='text/css'>
BODY { color : black }
BODY { background-color : white }
</style>
<script type='text/javascript' language='JavaScript' src='_odeerrcontrol_htm.js'>
</script>
</head>
<body>
<table><tr>
<td>
<a href="http://www.coin-or.org/CppAD/" target="_top"><img border="0" src="_image.gif"></a>
</td>
<td>
<select onchange='choose_across0(this)'>
<option>Index-&gt;</option>
<option>contents</option>
<option>reference</option>
<option>index</option>
<option>search</option>
<option>external</option>
</select>
</td>
<td>
<select onchange='choose_up0(this)'>
<option>Up-&gt;</option>
<option>CppAD</option>
<option>library</option>
<option>OdeErrControl</option>
</select>
</td>
<td><a href="rosen34.cpp.htm" target="_top">Prev</a>
</td><td><a href="odeerrcontrol.cpp.htm" target="_top">Next</a>
</td><td>
<select onchange='choose_down2(this)'>
<option>CppAD-&gt;</option>
<option>Install</option>
<option>Introduction</option>
<option>AD</option>
<option>ADFun</option>
<option>library</option>
<option>preprocessor</option>
<option>Example</option>
<option>Appendix</option>
</select>
</td>
<td>
<select onchange='choose_down1(this)'>
<option>library-&gt;</option>
<option>ErrorHandler</option>
<option>NearEqual</option>
<option>speed_test</option>
<option>SpeedTest</option>
<option>NumericType</option>
<option>CheckNumericType</option>
<option>SimpleVector</option>
<option>CheckSimpleVector</option>
<option>nan</option>
<option>pow_int</option>
<option>Poly</option>
<option>LuDetAndSolve</option>
<option>RombergOne</option>
<option>RombergMul</option>
<option>Runge45</option>
<option>Rosen34</option>
<option>OdeErrControl</option>
<option>OdeGear</option>
<option>OdeGearControl</option>
<option>BenderQuad</option>
<option>LuRatio</option>
<option>std_math_unary</option>
<option>CppAD_vector</option>
<option>TrackNewDel</option>
</select>
</td>
<td>
<select onchange='choose_down0(this)'>
<option>OdeErrControl-&gt;</option>
<option>OdeErrControl.cpp</option>
<option>OdeErrMaxabs.cpp</option>
</select>
</td>
<td>
<select onchange='choose_current0(this)'>
<option>Headings-&gt;</option>
<option>Syntax</option>
<option>Description</option>
<option>Include</option>
<option>Notation</option>
<option>xf</option>
<option>Method</option>
<option>---..step</option>
<option>---..Nan</option>
<option>---..order</option>
<option>ti</option>
<option>tf</option>
<option>xi</option>
<option>smin</option>
<option>smax</option>
<option>scur</option>
<option>eabs</option>
<option>erel</option>
<option>ef</option>
<option>maxabs</option>
<option>nstep</option>
<option>Error Criteria Discussion</option>
<option>Scalar</option>
<option>Vector</option>
<option>Example</option>
<option>Theory</option>
<option>Source Code</option>
</select>
</td>
</tr></table><br>










 
<center><b><big><big>An Error Controller for ODE Solvers</big></big></b></center>
<br>
<b><big><a name="Syntax" id="Syntax">Syntax</a></big></b>

<code><font color="blue"><br>
# include &lt;cppad/ode_err_control.hpp&gt;</font></code>
<code><span style='white-space: nowrap'><br>
</span></code><code><font color="blue"></font></code><i><span style='white-space: nowrap'>xf</span></i><code><font color="blue"><span style='white-space: nowrap'>&nbsp;=&nbsp;OdeErrControl(</span></font></code><i><span style='white-space: nowrap'>method</span></i><code><font color="blue"><span style='white-space: nowrap'>,&nbsp;</span></font></code><i><span style='white-space: nowrap'>ti</span></i><code><font color="blue"><span style='white-space: nowrap'>,&nbsp;</span></font></code><i><span style='white-space: nowrap'>tf</span></i><code><font color="blue"><span style='white-space: nowrap'>,&nbsp;</span></font></code><i><span style='white-space: nowrap'>xi</span></i><code><font color="blue"><span style='white-space: nowrap'>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font></code><i><span style='white-space: nowrap'>smin</span></i><code><font color="blue"><span style='white-space: nowrap'>,&nbsp;</span></font></code><i><span style='white-space: nowrap'>smax</span></i><code><font color="blue"><span style='white-space: nowrap'>,&nbsp;</span></font></code><i><span style='white-space: nowrap'>scur</span></i><code><font color="blue"><span style='white-space: nowrap'>,&nbsp;</span></font></code><i><span style='white-space: nowrap'>eabs</span></i><code><font color="blue"><span style='white-space: nowrap'>,&nbsp;</span></font></code><i><span style='white-space: nowrap'>erel</span></i><code><font color="blue"><span style='white-space: nowrap'>,&nbsp;</span></font></code><i><span style='white-space: nowrap'>ef</span></i><code><font color="blue"><span style='white-space: nowrap'>&nbsp;,&nbsp;</span></font></code><i><span style='white-space: nowrap'>maxabs</span></i><code><font color="blue"><span style='white-space: nowrap'>,&nbsp;</span></font></code><i><span style='white-space: nowrap'>nstep</span></i><code><font color="blue"><span style='white-space: nowrap'>&nbsp;)</span></font></code>


<br>
<br>
<b><big><a name="Description" id="Description">Description</a></big></b>
<br>
Let <code>
<span style='white-space: nowrap'>&nbsp;\R</span></code>
 denote the real numbers
and let <code>
<span style='white-space: nowrap'>&nbsp;F&nbsp;:&nbsp;\R&nbsp;\times&nbsp;\R^n&nbsp;\rightarrow&nbsp;\R^n</span></code>
 be a smooth function.
We define <code>
<span style='white-space: nowrap'>&nbsp;X&nbsp;:&nbsp;[ti&nbsp;,&nbsp;tf]&nbsp;\rightarrow&nbsp;\R^n</span></code>
 by 
the following initial value problem:
<code>
<span style='white-space: nowrap'>&nbsp;\[<br>
\begin{array}{rcl}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X(ti)&nbsp;&nbsp;&amp;&nbsp;=&nbsp;&amp;&nbsp;xi&nbsp;&nbsp;&nbsp;&nbsp;\\<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;X'(t)&nbsp;&nbsp;&amp;&nbsp;=&nbsp;&amp;&nbsp;F[t&nbsp;,&nbsp;X(t)]&nbsp;<br>
\end{array}<br>
\]&nbsp;</span></code>

The routine <code><font color="blue">OdeErrControl</font></code> can be used to adjust the step size
used an arbitrary integration methods in order to be as fast as possible
and still with in a requested error bound.

<br>
<br>
<b><big><a name="Include" id="Include">Include</a></big></b>
<br>
The file <code><font color="blue">cppad/ode_err_control.hpp</font></code> is included by 
<code><font color="blue">cppad/cppad.hpp</font></code>
but it can also be included separately with out the rest of 
the <code><font color="blue">CppAD</font></code> routines.

<br>
<br>
<b><big><a name="Notation" id="Notation">Notation</a></big></b>
<br>
The template parameter types <a href="odeerrcontrol.htm#Scalar" target="_top"><span style='white-space: nowrap'>Scalar</span></a>
 and
<a href="odeerrcontrol.htm#Vector" target="_top"><span style='white-space: nowrap'>Vector</span></a>
 are documented below.

<br>
<br>
<b><big><a name="xf" id="xf">xf</a></big></b>
<br>
The return value <i>xf</i> has the prototype
<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font></code><i><span style='white-space: nowrap'>Vector</span></i><code><font color="blue"><span style='white-space: nowrap'>&nbsp;</span></font></code><i><span style='white-space: nowrap'>xf</span></i><code><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>(see description of <a href="odeerrcontrol.htm#Vector" target="_top"><span style='white-space: nowrap'>Vector</span></a>
 below). 
and the size of <i>xf</i> is equal to <i>n</i>.
If <i>xf</i> contains not a number <a href="nan.htm" target="_top"><span style='white-space: nowrap'>nan</span></a>
,
see the discussion of <a href="odeerrcontrol.htm#Method.Nan" target="_top"><span style='white-space: nowrap'>step</span></a>
.

<br>
<br>
<b><big><a name="Method" id="Method">Method</a></big></b>
<br>
The class <i>Method</i>
and the object <i>method</i> satisfy the following syntax
<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font></code><i><span style='white-space: nowrap'>Method</span></i><code><font color="blue"><span style='white-space: nowrap'>&nbsp;&amp;</span></font></code><i><span style='white-space: nowrap'>method</span></i><code><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>The object <i>method</i> must support <code><font color="blue">step</font></code> and 
<code><font color="blue">order</font></code> member functions defined below:

<br>
<br>
<b><a name="Method.step" id="Method.step">step</a></b>
<br>
The syntax
<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font></code><i><span style='white-space: nowrap'>method</span></i><code><font color="blue"><span style='white-space: nowrap'>.step(</span></font></code><i><span style='white-space: nowrap'>ta</span></i><code><font color="blue"><span style='white-space: nowrap'>,&nbsp;</span></font></code><i><span style='white-space: nowrap'>tb</span></i><code><font color="blue"><span style='white-space: nowrap'>,&nbsp;</span></font></code><i><span style='white-space: nowrap'>xa</span></i><code><font color="blue"><span style='white-space: nowrap'>,&nbsp;</span></font></code><i><span style='white-space: nowrap'>xb</span></i><code><font color="blue"><span style='white-space: nowrap'>,&nbsp;</span></font></code><i><span style='white-space: nowrap'>eb</span></i><code><font color="blue"><span style='white-space: nowrap'>)<br>
</span></font></code>executes one step of the integration method. 
<code><font color="blue"><span style='white-space: nowrap'><br>
<br>
</span></font></code><i><span style='white-space: nowrap'>ta</span></i><code><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>The argument <i>ta</i> has prototype
<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;</span></font></code><i><span style='white-space: nowrap'>Scalar</span></i><code><font color="blue"><span style='white-space: nowrap'>&nbsp;&amp;</span></font></code><i><span style='white-space: nowrap'>ta</span></i><code><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>It specifies the initial time for this step in the 
ODE integration.
(see description of <a href="odeerrcontrol.htm#Scalar" target="_top"><span style='white-space: nowrap'>Scalar</span></a>
 below). 
<code><font color="blue"><span style='white-space: nowrap'><br>
<br>
</span></font></code><i><span style='white-space: nowrap'>tb</span></i><code><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>The argument <i>tb</i> has prototype
<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;</span></font></code><i><span style='white-space: nowrap'>Scalar</span></i><code><font color="blue"><span style='white-space: nowrap'>&nbsp;&amp;</span></font></code><i><span style='white-space: nowrap'>tb</span></i><code><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>It specifies the final time for this step in the 
ODE integration.
<code><font color="blue"><span style='white-space: nowrap'><br>
<br>
</span></font></code><i><span style='white-space: nowrap'>xa</span></i><code><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>The argument <i>xa</i> has prototype
<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;</span></font></code><i><span style='white-space: nowrap'>Vector</span></i><code><font color="blue"><span style='white-space: nowrap'>&nbsp;&amp;</span></font></code><i><span style='white-space: nowrap'>xa</span></i><code><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>and size <i>n</i>.
It specifies the value of <code>
<span style='white-space: nowrap'>&nbsp;X(ta)</span></code>
.
(see description of <a href="odeerrcontrol.htm#Vector" target="_top"><span style='white-space: nowrap'>Vector</span></a>
 below). 
<code><font color="blue"><span style='white-space: nowrap'><br>
<br>
</span></font></code><i><span style='white-space: nowrap'>xb</span></i><code><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>The argument value <i>xb</i> has prototype
<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font></code><i><span style='white-space: nowrap'>Vector</span></i><code><font color="blue"><span style='white-space: nowrap'>&nbsp;&amp;</span></font></code><i><span style='white-space: nowrap'>xb</span></i><code><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>and size <i>n</i>.
The input value of its elements does not matter.
On output, 
it contains the approximation for <code>
<span style='white-space: nowrap'>&nbsp;X(tb)</span></code>
 that the method obtains.
<code><font color="blue"><span style='white-space: nowrap'><br>
<br>
</span></font></code><i><span style='white-space: nowrap'>eb</span></i><code><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>The argument value <i>eb</i> has prototype
<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font></code><i><span style='white-space: nowrap'>Vector</span></i><code><font color="blue"><span style='white-space: nowrap'>&nbsp;&amp;</span></font></code><i><span style='white-space: nowrap'>eb</span></i><code><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>and size <i>n</i>.
The input value of its elements does not matter.
On output, 
it contains an estimate for the error in the approximation <i>xb</i>.
It is assumed (locally) that the error bound in this approximation 
nearly equal to <code>
<span style='white-space: nowrap'>&nbsp;K&nbsp;(tb&nbsp;-&nbsp;ta)^m</span></code>
 
where <i>K</i> is a fixed constant and <i>m</i>
is the corresponding argument to <code><font color="blue">CodeControl</font></code>.

<br>
<br>
<b><a name="Method.Nan" id="Method.Nan">Nan</a></b>
<br>
If any element of the vector <i>eb</i> or <i>xb</i> are
not a number <code><font color="blue">nan</font></code>,
the current step is considered to large.
If this happens with the current step size equal to <i>smin</i>, 
<code><font color="blue">OdeErrControl</font></code> returns with <i>xf</i> and <i>ef</i> as vectors
of <code><font color="blue">nan</font></code>.

<br>
<br>
<b><a name="Method.order" id="Method.order">order</a></b>
<br>
If <i>m</i> is <code><font color="blue">size_t</font></code>,
the object <i>method</i> must also support the following syntax 
<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font></code><i><span style='white-space: nowrap'>m</span></i><code><font color="blue"><span style='white-space: nowrap'>&nbsp;=&nbsp;</span></font></code><i><span style='white-space: nowrap'>method</span></i><code><font color="blue"><span style='white-space: nowrap'>.order()<br>
</span></font></code>The return value <i>m</i> is the order of the error estimate;
i.e., there is a constant K such that if <code>
<span style='white-space: nowrap'>&nbsp;ti&nbsp;\leq&nbsp;ta&nbsp;\leq&nbsp;tb&nbsp;\leq&nbsp;tf</span></code>
,
<code>
<span style='white-space: nowrap'>&nbsp;\[<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;eb(tb)&nbsp;|&nbsp;\leq&nbsp;K&nbsp;|&nbsp;tb&nbsp;-&nbsp;ta&nbsp;|^m<br>
\]&nbsp;</span></code>

where <i>ta</i>, <i>tb</i>, and <i>eb</i> are as in 
<code><font color="blue"></font></code><i><span style='white-space: nowrap'>method</span></i><code><font color="blue"><span style='white-space: nowrap'>.step(</span></font></code><i><span style='white-space: nowrap'>ta</span></i><code><font color="blue"><span style='white-space: nowrap'>,&nbsp;</span></font></code><i><span style='white-space: nowrap'>tb</span></i><code><font color="blue"><span style='white-space: nowrap'>,&nbsp;</span></font></code><i><span style='white-space: nowrap'>xa</span></i><code><font color="blue"><span style='white-space: nowrap'>,&nbsp;</span></font></code><i><span style='white-space: nowrap'>xb</span></i><code><font color="blue"><span style='white-space: nowrap'>,&nbsp;</span></font></code><i><span style='white-space: nowrap'>eb</span></i><code><font color="blue"><span style='white-space: nowrap'>)</span></font></code>


<br>
<br>
<b><big><a name="ti" id="ti">ti</a></big></b>
<br>
The argument <i>ti</i> has prototype
<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;</span></font></code><i><span style='white-space: nowrap'>Scalar</span></i><code><font color="blue"><span style='white-space: nowrap'>&nbsp;&amp;</span></font></code><i><span style='white-space: nowrap'>ti</span></i><code><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>It specifies the initial time for the integration of 
the differential equation.


<br>
<br>
<b><big><a name="tf" id="tf">tf</a></big></b>
<br>
The argument <i>tf</i> has prototype
<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;</span></font></code><i><span style='white-space: nowrap'>Scalar</span></i><code><font color="blue"><span style='white-space: nowrap'>&nbsp;&amp;</span></font></code><i><span style='white-space: nowrap'>tf</span></i><code><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>It specifies the final time for the integration of 
the differential equation.

<br>
<br>
<b><big><a name="xi" id="xi">xi</a></big></b>
<br>
The argument <i>xi</i> has prototype
<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;</span></font></code><i><span style='white-space: nowrap'>Vector</span></i><code><font color="blue"><span style='white-space: nowrap'>&nbsp;&amp;</span></font></code><i><span style='white-space: nowrap'>xi</span></i><code><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>and size <i>n</i>.
It specifies value of <code>
<span style='white-space: nowrap'>&nbsp;X(ti)</span></code>
.

<br>
<br>
<b><big><a name="smin" id="smin">smin</a></big></b>
<br>
The argument <i>smin</i> has prototype
<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;</span></font></code><i><span style='white-space: nowrap'>Scalar</span></i><code><font color="blue"><span style='white-space: nowrap'>&nbsp;&amp;</span></font></code><i><span style='white-space: nowrap'>smin</span></i><code><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>The step size during a call to <i>method</i> is defined as
the corresponding value of <code>
<span style='white-space: nowrap'>&nbsp;tb&nbsp;-&nbsp;ta</span></code>
.
If <code>
<span style='white-space: nowrap'>&nbsp;tf&nbsp;-&nbsp;ti&nbsp;\leq&nbsp;smin</span></code>
,
the integration will be done in one step of size <i>tf - ti</i>.
Otherwise,
the minimum value of <i>tb - ta</i> will be <code>
<span style='white-space: nowrap'>&nbsp;smin</span></code>

except for the last two calls to <i>method</i> where it may be
as small as <code>
<span style='white-space: nowrap'>&nbsp;smin&nbsp;/&nbsp;2</span></code>
.

<br>
<br>
<b><big><a name="smax" id="smax">smax</a></big></b>
<br>
The argument <i>smax</i> has prototype
<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;</span></font></code><i><span style='white-space: nowrap'>Scalar</span></i><code><font color="blue"><span style='white-space: nowrap'>&nbsp;&amp;</span></font></code><i><span style='white-space: nowrap'>smax</span></i><code><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>It specifies the maximum step size to use during the integration; 
i.e., the maximum value for <code>
<span style='white-space: nowrap'>&nbsp;tb&nbsp;-&nbsp;ta</span></code>
 in a call to <i>method</i>.
The value of <i>smax</i> must be greater than or equal <i>smin</i>.

<br>
<br>
<b><big><a name="scur" id="scur">scur</a></big></b>
<br>
The argument <i>scur</i> has prototype
<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font></code><i><span style='white-space: nowrap'>Scalar</span></i><code><font color="blue"><span style='white-space: nowrap'>&nbsp;&amp;</span></font></code><i><span style='white-space: nowrap'>scur</span></i><code><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>The value of <i>scur</i> is the suggested next step size,
based on error criteria, to try in the next call to <i>method</i>.
On input it corresponds to the first call to <i>method</i>,
in this call to <code><font color="blue">OdeErrControl</font></code> (where <code>
<span style='white-space: nowrap'>&nbsp;ta&nbsp;=&nbsp;ti</span></code>
).
On output it corresponds to the next call to <i>method</i>,
in a subsequent call to <code><font color="blue">OdeErrControl</font></code> (where <i>ta = tf</i>).

<br>
<br>
<b><big><a name="eabs" id="eabs">eabs</a></big></b>
<br>
The argument <i>eabs</i> has prototype
<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;</span></font></code><i><span style='white-space: nowrap'>Vector</span></i><code><font color="blue"><span style='white-space: nowrap'>&nbsp;&amp;</span></font></code><i><span style='white-space: nowrap'>eabs</span></i><code><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>and size <i>n</i>.
Each of the elements of <i>eabs</i> must be 
greater than or equal zero.
It specifies a bound for the absolute
error in the return value <i>xf</i> as an approximation for <code>
<span style='white-space: nowrap'>&nbsp;X(tf)</span></code>
.
(see the 
<a href="odeerrcontrol.htm#Error Criteria Discussion" target="_top"><span style='white-space: nowrap'>error&nbsp;criteria&nbsp;discussion</span></a>
 
below). 

<br>
<br>
<b><big><a name="erel" id="erel">erel</a></big></b>
<br>
The argument <i>erel</i> has prototype
<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;</span></font></code><i><span style='white-space: nowrap'>Scalar</span></i><code><font color="blue"><span style='white-space: nowrap'>&nbsp;&amp;</span></font></code><i><span style='white-space: nowrap'>erel</span></i><code><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>and is greater than or equal zero.
It specifies a bound for the relative 
error in the return value <i>xf</i> as an approximation for <code>
<span style='white-space: nowrap'>&nbsp;X(tf)</span></code>

(see the 
<a href="odeerrcontrol.htm#Error Criteria Discussion" target="_top"><span style='white-space: nowrap'>error&nbsp;criteria&nbsp;discussion</span></a>
 
below). 

<br>
<br>
<b><big><a name="ef" id="ef">ef</a></big></b>
<br>
The argument value <i>ef</i> has prototype
<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font></code><i><span style='white-space: nowrap'>Vector</span></i><code><font color="blue"><span style='white-space: nowrap'>&nbsp;&amp;</span></font></code><i><span style='white-space: nowrap'>ef</span></i><code><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>and size <i>n</i>.
The input value of its elements does not matter.
On output, 
it contains an estimated bound for the 
absolute error in the approximation <i>xf</i>; i.e.,
<code>
<span style='white-space: nowrap'>&nbsp;\[<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ef_i&nbsp;&gt;&nbsp;|&nbsp;X(&nbsp;tf&nbsp;)_i&nbsp;-&nbsp;xf_i&nbsp;|<br>
\]&nbsp;</span></code>

If on output <i>ef</i> contains not a number <code><font color="blue">nan</font></code>,
see the discussion of <a href="odeerrcontrol.htm#Method.Nan" target="_top"><span style='white-space: nowrap'>step</span></a>
.

<br>
<br>
<b><big><a name="maxabs" id="maxabs">maxabs</a></big></b>
<br>
The argument <i>maxabs</i> is optional in the call to <code><font color="blue">OdeErrControl</font></code>.
If it is present, it has the prototype
<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font></code><i><span style='white-space: nowrap'>Vector</span></i><code><font color="blue"><span style='white-space: nowrap'>&nbsp;&amp;</span></font></code><i><span style='white-space: nowrap'>maxabs</span></i><code><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>and size <i>n</i>.
The input value of its elements does not matter.
On output, 
it contains an estimate for the 
maximum absolute value of <code>
<span style='white-space: nowrap'>&nbsp;X(t)</span></code>
; i.e.,
<code>
<span style='white-space: nowrap'>&nbsp;\[<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maxabs[i]&nbsp;\approx&nbsp;\max&nbsp;\left\{&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;X(&nbsp;t&nbsp;)_i&nbsp;|&nbsp;\;&nbsp;:&nbsp;\;&nbsp;&nbsp;t&nbsp;\in&nbsp;[ti,&nbsp;tf]&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\right\}<br>
\]&nbsp;</span></code>


<br>
<br>
<b><big><a name="nstep" id="nstep">nstep</a></big></b>
<br>
The argument <i>nstep</i> is optional in the call to <code><font color="blue">OdeErrControl</font></code>.
If it is present, it has the prototype
<code><font color="blue"><span style='white-space: nowrap'><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></font></code><i><span style='white-space: nowrap'>size_t</span></i><code><font color="blue"><span style='white-space: nowrap'>&nbsp;&amp;</span></font></code><i><span style='white-space: nowrap'>nstep</span></i><code><font color="blue"><span style='white-space: nowrap'><br>
</span></font></code>Its input value does not matter and its output value
is the number of calls to <code><font color="blue"></font></code><i><span style='white-space: nowrap'>method</span></i><code><font color="blue"><span style='white-space: nowrap'>.step</span></font></code> 
used by <code><font color="blue">OdeErrControl</font></code>.

<br>
<br>
<b><big><a name="Error Criteria Discussion" id="Error Criteria Discussion">Error Criteria Discussion</a></big></b>
<br>
The relative error criteria <i>erel</i> and
absolute error criteria <i>eabs</i> are enforced during each step of the
integration of the ordinary differential equations.
In addition, they are inversely scaled by the step size so that
the total error bound is less than the sum of the error bounds.
To be specific, if <code>
<span style='white-space: nowrap'>&nbsp;\tilde{X}&nbsp;(t)</span></code>
 is the approximate solution
at time <code>
<span style='white-space: nowrap'>&nbsp;t</span></code>
, 
<i>ta</i> is the initial step time,
and <i>tb</i> is the final step time,
<code>
<span style='white-space: nowrap'>&nbsp;\[<br>
\left|&nbsp;\tilde{X}&nbsp;(tb)_j&nbsp;&nbsp;-&nbsp;X&nbsp;(tb)_j&nbsp;\right|&nbsp;<br>
\leq&nbsp;<br>
\frac{tf&nbsp;-&nbsp;ti}{tb&nbsp;-&nbsp;ta}<br>
\left[&nbsp;eabs[j]&nbsp;+&nbsp;erel&nbsp;\;&nbsp;&nbsp;|&nbsp;\tilde{X}&nbsp;(tb)_j&nbsp;|&nbsp;\right]&nbsp;<br>
\]&nbsp;</span></code>

If <code>
<span style='white-space: nowrap'>&nbsp;X(tb)_j</span></code>
 is near zero for some <code>
<span style='white-space: nowrap'>&nbsp;tb&nbsp;\in&nbsp;[ti&nbsp;,&nbsp;tf]</span></code>
,
and one uses an absolute error criteria <code>
<span style='white-space: nowrap'>&nbsp;eabs[j]</span></code>
 of zero,
the error criteria above will force <code><font color="blue">OdeErrControl</font></code>
to use step sizes equal to 
<a href="odeerrcontrol.htm#smin" target="_top"><span style='white-space: nowrap'>smin</span></a>

for steps ending near <code>
<span style='white-space: nowrap'>&nbsp;tb</span></code>
.
In this case, the error relative to <i>maxabs</i> can be judged after
<code><font color="blue">OdeErrControl</font></code> returns.
If <i>ef</i> is to large relative to <i>maxabs</i>, 
<code><font color="blue">OdeErrControl</font></code> can be called again 
with a smaller value of <i>smin</i>.

<br>
<br>
<b><big><a name="Scalar" id="Scalar">Scalar</a></big></b>
<br>
The type <i>Scalar</i> must satisfy the conditions
for a <a href="numerictype.htm" target="_top"><span style='white-space: nowrap'>NumericType</span></a>
 type.
The routine <a href="checknumerictype.htm" target="_top"><span style='white-space: nowrap'>CheckNumericType</span></a>
 will generate an error message
if this is not the case.
In addition, the following operations must be defined for 
<i>Scalar</i> objects <i>a</i> and <i>b</i>:

<table><tr><td align='left'  valign='top'>

<b>Operation</b> </td><td align='left'  valign='top'>
 <b>Description</b>  </td></tr><tr><td align='left'  valign='top'>

<code><font color="blue"></font></code><i><span style='white-space: nowrap'>a</span></i><code><font color="blue"><span style='white-space: nowrap'>&nbsp;&lt;=&nbsp;</span></font></code><i><span style='white-space: nowrap'>b</span></i> </td><td align='left'  valign='top'>

	returns true (false) if <i>a</i> is less than or equal 
	(greater than) <i>b</i>.
</td></tr><tr><td align='left'  valign='top'>

<code><font color="blue"></font></code><i><span style='white-space: nowrap'>a</span></i><code><font color="blue"><span style='white-space: nowrap'>&nbsp;==&nbsp;</span></font></code><i><span style='white-space: nowrap'>b</span></i> </td><td align='left'  valign='top'>

	returns true (false) if <i>a</i> is equal to <i>b</i>.
</td></tr><tr><td align='left'  valign='top'>

<code><font color="blue"><span style='white-space: nowrap'>log(</span></font></code><i><span style='white-space: nowrap'>a</span></i><code><font color="blue"><span style='white-space: nowrap'>)</span></font></code> </td><td align='left'  valign='top'>

	returns a <i>Scalar</i> equal to the logarithm of <i>a</i>
</td></tr><tr><td align='left'  valign='top'>

<code><font color="blue"><span style='white-space: nowrap'>exp(</span></font></code><i><span style='white-space: nowrap'>a</span></i><code><font color="blue"><span style='white-space: nowrap'>)</span></font></code> </td><td align='left'  valign='top'>

	returns a <i>Scalar</i> equal to the exponential of <i>a</i>
</td></tr>
</table>
<br>
<b><big><a name="Vector" id="Vector">Vector</a></big></b>
<br>
The type <i>Vector</i> must be a <a href="simplevector.htm" target="_top"><span style='white-space: nowrap'>SimpleVector</span></a>
 class with
<a href="simplevector.htm#Elements of Specified Type" target="_top"><span style='white-space: nowrap'>elements&nbsp;of&nbsp;type&nbsp;Scalar</span></a>
.
The routine <a href="checksimplevector.htm" target="_top"><span style='white-space: nowrap'>CheckSimpleVector</span></a>
 will generate an error message
if this is not the case.

<br>
<br>
<b><big><a name="Example" id="Example">Example</a></big></b>

<br>
The files
<a href="odeerrcontrol.cpp.htm" target="_top"><span style='white-space: nowrap'>OdeErrControl.cpp</span></a>

and
<a href="odeerrmaxabs.cpp.htm" target="_top"><span style='white-space: nowrap'>OdeErrMaxabs.cpp</span></a>

contain examples and tests of using this routine.
They return true if they succeed and false otherwise.

<br>
<br>
<b><big><a name="Theory" id="Theory">Theory</a></big></b>
<br>
Let <code>
<span style='white-space: nowrap'>&nbsp;e(s)</span></code>
 be the error as a function of the
step size <code>
<span style='white-space: nowrap'>&nbsp;s</span></code>
 and suppose that there is a constant
<code>
<span style='white-space: nowrap'>&nbsp;K</span></code>
 such that <code>
<span style='white-space: nowrap'>&nbsp;e(s)&nbsp;=&nbsp;K&nbsp;s^m</span></code>
.
Let <code>
<span style='white-space: nowrap'>&nbsp;a</span></code>
 be our error bound.
Given the value of <code>
<span style='white-space: nowrap'>&nbsp;e(s)</span></code>
, a step of size <code>
<span style='white-space: nowrap'>&nbsp;\lambda&nbsp;s</span></code>

would be ok provided that
<code>
<span style='white-space: nowrap'>&nbsp;\[<br>
\begin{array}{rcl}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;&nbsp;&amp;&nbsp;\geq&nbsp;&amp;&nbsp;e(&nbsp;\lambda&nbsp;s&nbsp;)&nbsp;(tf&nbsp;-&nbsp;ti)&nbsp;/&nbsp;(&nbsp;\lambda&nbsp;s&nbsp;)&nbsp;\\<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;&nbsp;&amp;&nbsp;\geq&nbsp;&amp;&nbsp;K&nbsp;\lambda^m&nbsp;s^m&nbsp;(tf&nbsp;-&nbsp;ti)&nbsp;/&nbsp;(&nbsp;\lambda&nbsp;s&nbsp;)&nbsp;\\<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;&nbsp;&amp;&nbsp;\geq&nbsp;&amp;&nbsp;\lambda^{m-1}&nbsp;s^{m-1}&nbsp;(tf&nbsp;-&nbsp;ti)&nbsp;e(s)&nbsp;/&nbsp;s^m&nbsp;\\<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;&nbsp;&amp;&nbsp;\geq&nbsp;&amp;&nbsp;\lambda^{m-1}&nbsp;(tf&nbsp;-&nbsp;ti)&nbsp;e(s)&nbsp;/&nbsp;s&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\lambda^{m-1}&nbsp;&amp;&nbsp;\leq&nbsp;&amp;&nbsp;\frac{a}{e(s)}&nbsp;\frac{s}{tf&nbsp;-&nbsp;ti}<br>
\end{array}<br>
\]&nbsp;</span></code>

Thus if the right hand side of the last inequality is greater 
than or equal to one, the step of size <code>
<span style='white-space: nowrap'>&nbsp;s</span></code>
 is ok. 

<br>
<br>
<b><big><a name="Source Code" id="Source Code">Source Code</a></big></b>
<br>
The source code for this routine is in the file
<code><font color="blue">cppad/ode_err_control.hpp</font></code>.


<hr>Input File: cppad/ode_err_control.hpp

</body>
</html>
